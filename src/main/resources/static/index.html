<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Person Management</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>

<h1>Person Management</h1>

<div class="management-container">
    <div class="page-controls">
        <button onclick="toggleFormVisibility()">Add New Person</button>
    </div>

    <div id="form-wrapper" style="display: none;">
        <div class="form-grid">
            <label for="name">Name:</label>
            <input type="text" id="name" placeholder="Enter name (ID)">

            <label for="email">Email:</label>
            <input type="email" id="email" placeholder="Enter email">

            <label for="address">Address:</label>
            <input type="text" id="address" placeholder="Enter address">

            <label for="phone">Phone:</label>
            <input type="text" id="phone" placeholder="Enter phone number">

            <label for="age">Age:</label>
            <input type="number" id="age" placeholder="Enter age">

            <label for="gender">Gender:</label>
            <input type="text" id="gender" placeholder="Enter gender">
        </div>

        <div class="button-group">
            <button onclick="addPerson()">Add Person</button>
            <button onclick="updatePerson()">Update Person</button>
            <button onclick="deletePerson()">Delete Person</button>
            <button onclick="findPerson()">Find Person by Name</button>
        </div>

        <div id="message"></div>
    </div>

    <hr>

    <h2>All Persons</h2>
    <ul id="person-list"></ul>
</div>


<script>
    const nameInput = document.getElementById('name');
    const emailInput = document.getElementById('email');
    const addressInput = document.getElementById('address');
    const phoneInput = document.getElementById('phone');
    const ageInput = document.getElementById('age');
    const genderInput = document.getElementById('gender');
    const messageDiv = document.getElementById('message');
    const personListUl = document.getElementById('person-list');
    const formWrapper = document.getElementById('form-wrapper');

    const API_URL = '/persons';

    function toggleFormVisibility() {
        if (formWrapper.style.display === 'none') {
            formWrapper.style.display = 'block';
        } else {
            formWrapper.style.display = 'none';
        }
    }

    // --- Main Functions ---

    async function addPerson() {
        const person = getPersonFromForm();
        if (!person.name) {
            showMessage('Name is required to add a person.', 'error');
            return;
        }

        try {
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(person)
            });
            if (response.ok) {
                showMessage(`Person '${person.name}' added successfully.`, 'success');
                clearForm();
                loadAllPersons();
                formWrapper.style.display = 'none'; // Hide form after successful add
            } else {
                throw new Error(`Server responded with ${response.status}`);
            }
        } catch (error) {
            showMessage(`Error adding person: ${error.message}`, 'error');
        }
    }

    async function updatePerson() {
        const person = getPersonFromForm();
        if (!person.name) {
            showMessage('Name is required to identify the person to update.', 'error');
            return;
        }

        try {
            const response = await fetch(`${API_URL}/${encodeURIComponent(person.name)}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(person)
            });
            if (response.ok) {
                showMessage(`Person '${person.name}' updated successfully.`, 'success');
                clearForm();
                loadAllPersons();
            } else {
                throw new Error(`Server responded with ${response.status}`);
            }
        } catch (error) {
            showMessage(`Error updating person: ${error.message}`, 'error');
        }
    }

    async function deletePerson() {
        const name = nameInput.value;
        if (!name) {
            showMessage('Name is required to identify the person to delete.', 'error');
            return;
        }

        if (!confirm(`Are you sure you want to delete '${name}'?`)) {
            return;
        }

        try {
            const response = await fetch(`${API_URL}/${encodeURIComponent(name)}`, {
                method: 'DELETE'
            });
            if (response.ok) {
                showMessage(`Person '${name}' deleted successfully.`, 'success');
                clearForm();
                loadAllPersons();
            } else {
                throw new Error(`Server responded with ${response.status}`);
            }
        } catch (error) {
            showMessage(`Error deleting person: ${error.message}`, 'error');
        }
    }

    async function findPerson() {
        const name = nameInput.value;
        if (!name) {
            showMessage('Please enter a name to find.', 'error');
            return;
        }
        try {
            const response = await fetch(`${API_URL}/${encodeURIComponent(name)}`);
            if (response.ok) {
                const person = await response.json();
                if (person) {
                    populateForm(person);
                    showMessage(`Found person '${name}'.`, 'success');
                    formWrapper.style.display = 'block'; // Show form if hidden
                } else {
                     showMessage(`Person '${name}' not found.`, 'error');
                }
            } else {
                throw new Error(`Server responded with ${response.status}`);
            }
        } catch (error) {
             showMessage(`Error finding person: ${error.message}`, 'error');
        }
    }

    async function loadAllPersons() {
        try {
            const response = await fetch(API_URL);
            const persons = await response.json();
            personListUl.innerHTML = ''; // Clear current list
            persons.forEach(person => {
                const li = document.createElement('li');
                li.textContent = person.name;
                li.onclick = () => {
                    populateForm(person);
                    formWrapper.style.display = 'block'; // Show form on selection
                }
                personListUl.appendChild(li);
            });
        } catch (error) {
            showMessage('Could not load person list.', 'error');
        }
    }

    // --- Helper Functions ---

    function getPersonFromForm() {
        return {
            name: nameInput.value,
            email: emailInput.value,
            address: addressInput.value,
            phone: phoneInput.value,
            age: parseInt(ageInput.value, 10) || 0,
            gender: genderInput.value
        };
    }

    function populateForm(person) {
        nameInput.value = person.name || '';
        emailInput.value = person.email || '';
        addressInput.value = person.address || '';
        phoneInput.value = person.phone || '';
        ageInput.value = person.age || '';
        genderInput.value = person.gender || '';
    }

    function clearForm() {
        nameInput.value = '';
        emailInput.value = '';
        addressInput.value = '';
        phoneInput.value = '';
        ageInput.value = '';
        genderInput.value = '';
    }

    function showMessage(msg, type = 'info') {
        messageDiv.textContent = msg;
        messageDiv.className = type; // Use classes for styling
    }

    // Initial load
    document.addEventListener('DOMContentLoaded', loadAllPersons);

</script>

</body>
</html>